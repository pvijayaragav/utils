
* These steps are for Centos 7.4 and higher
  Note : you need not install k8s seperately, this deployer installs it for you

* Install required/useful tools
```
yum -y install epel-release git ansible net-tools
```

* Clone contrail-ansible-deployer repo
```
git clone https://github.com/Juniper/contrail-ansible-deployer.git
cd contrail-ansible-deployer
```

* Edit config/instances.yaml and fill in appropriate values.
  Here is a sample file for 2 node kubernetes install.

```
Sample1 config/instances.yaml

provider_config:
  bms:
   ssh_pwd: <Password>
   ssh_user: root
   ssh_public_key: /root/.ssh/id_rsa.pub
   ssh_private_key: /root/.ssh/id_rsa
   domainsuffix: local
instances:
  bms1:
   provider: bms
   roles:            # Optional.  If roles is not defined, all below roles will be created
      config_database:         # Optional.
      config:                  # Optional.
      control:                 # Optional.
      analytics_database:      # Optional.
      analytics:               # Optional.
      webui:                   # Optional.
      k8s_master:              # Optional.
      kubemanager:             # Optional.
   ip: <BMS1 IP>
  bms2:
   provider: bms
   roles:            # Optional.  If roles is not defined, all below roles will be created
     vrouter:        # Optional.
     k8s_node:       # Optional.
   ip: <BMS2 IP>
contrail_configuration:
  CONTAINER_REGISTRY: opencontrailnightly
  CONTRAIL_VERSION: latest
  KUBERNETES_CLUSTER_PROJECT: {}
```
```
Sample2 config/instances.yaml

provider_config:
  bms:
   ssh_pwd: <password>
   ssh_user: root 
   ssh_public_key: ~/.ssh/id_rsa.pub
   ssh_private_key: ~/.ssh/id_rsa
   domainsuffix: local
instances:
  bms1:
   provider: bms
   roles:
      config_database:
      config:
      control:
      analytics_database:
      analytics:
      webui:
      k8s_master:
      kubemanager:
   ip: 20.1.1.1 
  bms2:
   provider: bms
   roles:
     vrouter:
      PHYSICAL_INTERFACE: ens2f0
     k8s_node:
   ip: 20.1.1.2
  bms3:
   provider: bms
   roles:
     vrouter:
      PHYSICAL_INTERFACE: ens2f0
     k8s_node:
   ip: 20.1.1.3
contrail_configuration:
  CONTAINER_REGISTRY: opencontrailnightly
  CONTRAIL_VERSION: latest
  KUBERNETES_CLUSTER_PROJECT: {}
  CONTROLLER_NODES: 20.1.1.1
  PHYSICAL_INTERFACE: ens2f0
  VROUTER_GATEWAY: 20.1.1.254

* Turn swap off:
``` 
swapoff -a
```

* Run Configure
```
ansible-playbook -e orchestrator=kubernetes -i inventory/ playbooks/configure_instances.yml
```

* Run Install
```
ansible-playbook -e orchestrator=kubernetes -i inventory/ playbooks/install_contrail.yml
ansible-playbook -e orchestrator=kubernetes -i inventory/ playbooks/install_k8s.yml
```
